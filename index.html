<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <!-- model-viewer -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

    <style>
      body { margin: 0; }
      model-viewer { width: 100vw; height: 100vh; }
      #controls {
        position: fixed; top: 10px; left: 10px;
        background: white; padding: 10px; border-radius: 10px; z-index: 20;
      }
    </style>
  </head>

  <body>

    <model-viewer id="mv"
      src="model2.glb"
      camera-controls
      ar
      environment-image="neutral"
      style="width:100vw; height:100vh;"
    >
    </model-viewer>

    <div id="controls">
      <div>Parts:</div>
      <button onclick="togglePart('box')">box</button>
      <button onclick="togglePart('drawer')">drawer</button>
      <button onclick="togglePart('front')">front</button>
    </div>

<!-- 自動ホットスポット生成 -->
<script type="module">
  const mv = document.querySelector("#mv");

  mv.addEventListener("load", async () => {
    await mv.updateComplete;

    // model-viewer内部のTHREEを取得
    const THREE = mv.constructor.THREE;

    const scene = mv.model.scene;
    console.log("Scene ready. Generating hotspots…");

    scene.traverse(obj => {
      if (obj.isMesh && obj.name) {

        const box = new THREE.Box3().setFromObject(obj);
        const center = new THREE.Vector3();
        box.getCenter(center);

        console.log(`Mesh: ${obj.name} center:`, center);

        const btn = document.createElement("button");
        btn.slot = `hotspot-${obj.name}`;
        btn.innerText = obj.name;

        btn.setAttribute("data-position",
          `${center.x} ${center.y} ${center.z}`
        );
        btn.setAttribute("data-normal", "0 0 1");

        mv.appendChild(btn);
      }
    });
  });

  console.log("MODEL:", mv.model);
  console.log("SCENE:", mv.model && mv.model.scene);

</script>

<script>
  function togglePart(name) {
    const mv = document.querySelector("#mv");
    const obj = mv.model && mv.model.getObjectByName(name);
    if (!obj) return;
    obj.visible = !obj.visible;
  }
</script>

  </body>
</html>
