<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
    </script>

    <style>
      body { margin: 0; }

      model-viewer {
        width: 100vw;
        height: 100vh;
      }

      #controls {
        position: fixed;
        top: 10px;
        left: 10px;
        background: white;
        padding: 10px;
        border-radius: 10px;
        z-index: 20;
      }

      #infoPanel {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(255,255,255,0.95);
        border-top: 2px solid #ccc;
        padding: 15px;
        font-size: 16px;
        display: none;
        z-index: 30;
      }

      #infoPanelClose {
        float: right;
        cursor: pointer;
        font-size: 20px;
      }
    </style>
  </head>

  <body>
    <model-viewer id="mv"
      src="model.glb"
      camera-controls
      environment-image="neutral"
      ar
      style="width:100vw; height:100vh;"
    >

      <!-- ★ ホットスポット（部品説明用） -->
      <button slot="hotspot-1"
        data-position="0.3 0.4 0.2"
        data-normal="0 1 0"
        class="hotspot"
        data-part="drawer">
        ①
      </button>

      <button slot="hotspot-2"
        data-position="-0.3 0.4 0.2"
        data-normal="0 1 0"
        class="hotspot"
        data-part="front">
        ②
      </button>

    </model-viewer>

    <!-- パーツON/OFF -->
    <div id="controls">
      <div>Parts:</div>
      <button onclick="togglePart('box')">box</button>
      <button onclick="togglePart('drawer')">drawer</button>
      <button onclick="togglePart('front')">front</button>
    </div>

    <!-- 説明パネル -->
    <div id="infoPanel">
      <span id="infoPanelClose" onclick="closeInfo()">✕</span>
      <div id="infoContent"></div>
    </div>

    <script>
      const mv = document.querySelector("#mv");
      let sceneReady = false;

      mv.addEventListener("load", async () => {
        await mv.updateComplete;
        sceneReady = true;
      });

      // ---- パーツ切り替え ----
      async function togglePart(target) {
        if (!sceneReady) return;
        await mv.updateComplete;

        const scene = mv.model.scene;
        if (!scene) return;

        scene.traverse(obj => {
          if (obj.isMesh && obj.name === target) {
            obj.visible = !obj.visible;
          }
        });
      }

      // ---- ホットスポット押したら説明を出す ----
      const descriptions = {
        drawer: "引き出しの前板。ネジは4×25mmを使用します。",
        front: "前面板です。上下方向に注意してください。"
      };

      document.querySelectorAll(".hotspot").forEach(btn => {
        btn.addEventListener("click", () => {
          const part = btn.dataset.part;
          document.getElementById("infoContent").innerText = descriptions[part];
          document.getElementById("infoPanel").style.display = "block";
        });
      });

      function closeInfo() {
        document.getElementById("infoPanel").style.display = "none";
      }

      mv.addEventListener("load", async () => {
        await mv.updateComplete;

        const scene = mv.model.scene;
        scene.traverse(obj => {
          console.log(obj.name, obj.position);
        });
      });
    </script>

  </body>
</html>
